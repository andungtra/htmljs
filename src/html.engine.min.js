// HTML engine JavaScript library
// (c) Nguyen Ta An Nhan - http://nhanfu.github.io/htmljs/api/index.html
// License: MIT (http://www.opensource.org/licenses/mit-license.php)
//declare name-space
//check if an object has some properties
//loop through properties of an object
//get all properties values - for full text search
// expose some useful function
//Method Not documented
//http://codegolf.stackexchange.com/questions/2211/smallest-javascript-css-selector-engine
//must implement ajax using Promise pattern
//we can reuse jQuery ajax for fast release
//firstly, try to implement promise with setTimeout
// call the ready function to load all id, set them to html.id
// this is for avoiding hard code for id
!function(t,e){"use strict"
"object"==typeof module&&"object"==typeof module.exports?module.exports=e(t):"function"==typeof define&&define.amd?define(e(t)):t.html=e(t)}(this||(0,eval)("this"),function(t){"use strict"
var e=t.document,n=t.JSON,i=!e.addEventListener,r=Array.prototype,a=Object.prototype,s=r.isArray||function(t){return"[object Array]"===a.toString.call(t)},o=function(t){return"[object Function]"===a.toString.call(t)},l=function(t){return"string"==typeof t},u=function(t){return void 0===t||null===t},c=function(t){return void 0!==t&&null!==t},h=function(t){return/^-?\d+\.?\d*$/.test(t)},d=function(t){return e.body.contains(t)},f=String.prototype.trim,p=String.prototype.trimLeft,v=String.prototype.trimRight,g=function(e,n){return o(e)?g.ready(e):l(e)||e&&e.nodeType||e===t?g.get(e,n):void 0},m=function(){var t=navigator.userAgent.toLowerCase()
return-1!==t.indexOf("msie")?parseInt(t.split("msie")[1]):!1},y=9===m(),b=function(t){return"object"==typeof t&&c(t)&&!g.isDate(t)},D=function(t,e){var n
for(n in t)t.hasOwnProperty(n)&&e.call(t,t[n],n)},w=function(t){return f&&f.call(t)||t.replace(/^\s+|\s+$/,"")},E=function(t){return p&&p.call(t)||t.replace(/^\s+/,"")},A=function(t){return v&&v.call(t)||t.replace(/\s+$/,"")},x=function(t){return w(t).toLowerCase().replace(/\s{2,}/g," ")},C=function(t){var e=""
return D(t,function(t){var n=t
b(t)&&(n=C(t)),t.isComputed&&t.isComputed()&&(n=t(),b(n)&&(n=C(n))),n&&(e+=n.toString()+" ")}),e}
return g.isIE=m,g.isArray=s,g.isStrNumber=h,g.isNotNull=c,g.isNoU=u,g.isInDOM=d,g.trim=w,g.trimLeft=E,g.trimRight=A,g.config={lazyInput:!1,historyEnabled:!0},g.version="1.0.2",function(){function n(t,e,n){var i=function(i){i=R.where.call(i,function(t){return t.isValid===!1}),n&&n(i,t,e),t.displayDefaultErrorMessage!==!1&&g.displayErrorMessage(i,t,e)}
t.validationCallback=i}function f(t,e,n){t.subscribe&&t.subscribe(function(t){n.setAttribute(e,t)})}function p(t){return null!==t&&t===t.window}function v(t){return p(t)?t:9===t.nodeType&&t.defaultView}var m,E,A={},k={}
this.extend=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])
return t},this.expando=function(t,e){var n
return c(e)?(n=m.uniqueId||++_,m.uniqueId=n,k[n]=k[n]||{},k[n][t]=e,void 0):(n=m.uniqueId,n&&k[n]?k[n][t]:null)},this.get=function(e,n){if(e&&(e.nodeType||e===t))m=e
else if(l(e)){var i=this.query(e,n)[0]
m=i}return this},this.find=function(t){return m=this.query(t,m)[0],this}
var R=this.array=function(){var t=Array.apply({},arguments[0]||[])
return g.extend(t,g.array),t};(function(){function t(t,e,n){return function(i){return t[e]instanceof Function?t[e](i):n?g.getData(i[t[e]]):g.getData(i[t[e].field])}}this.each=r.forEach||function(t){for(var e=this.length,n=-1;++n<e;)t(this[n],n)},this.add=Array.prototype.push,this.select=function(t){for(var e=[],n=this.length,i=-1;++i<n;)e.push(t(this[i]))
return g.array(e)},this.where=function(t){if(!t)throw"Predicate function is required"
for(var e=[],n=this.length,i=-1;++i<n;)t(this[i])&&e.push(this[i])
return g.array(e)},this.reduce=r.reduce||function(t,e,n){n=n||this
for(var i=c(e)?e:[],r=this.length,a=-1;++a<r;)i=t.call(n,i,this[a])
return i},this.reduceRight=r.reduceRight||function(t,e,n){for(var i=c(e)?e:[],r=this.length;r--;)i=t.call(n,i,this[r])
return i},this.find=function(t,e){var n=e?this.select(e):this
return n.reduce(function(e,n){return e===t(e,n)?e:n},n[0])},this.first=function(t,e){if(!t)return this[0]
for(var n=this.length,i=-1;++i<n;)if(t.call(e,this[i]))return this[i]
throw"Can't find any element matches"},this.firstOrDefault=function(t,e){if(!t)return this[0]
for(var n=this.length,i=-1;++i<n;)if(t.call(e,this[i]))return this[i]
return null},this.indexOf=r.indexOf||function(t){for(var e=this.length,n=-1;++n<e;)if(this[n]===t)return n
return-1},this.remove=function(t){var e=this.indexOf(t)
e>=0&&e<this.length&&this.splice(e,1)},this.removeAt=function(t){t>=0&&t<this.length&&this.splice(t,1)},this.swap=function(t,e){if(t>=0&&t<this.length&&e>=0&&e<this.length&&t!==e){var n=this[t]
this[t]=this[e],this[e]=n}},this.move=function(t,e){this.splice(e,0,this.splice(t,1)[0])}
var e=function(t){return function(e,n){for(var i=0,r=t.length;r>i;i++){var a=i===r-1,s=t[i].expression(e),o=t[i].expression(n)
if(s>o)return t[i].isAscendant?1:-1
if(o>s)return t[i].isAscendant?-1:1
if(a)return t[i].isAscendant&&0}return 0}}
this.orderBy=function(){for(var n=[],i=arguments[0]instanceof Array?arguments[0]:arguments,r=0,a=i.length;a>r;r++){var s="string"==typeof i[r],l=t(i,r,s)
s||o(i[r])?n.push({expression:l,isAscendant:c(i[r].isAsc)?i[r].isAsc:!0}):n.push({expression:l,isAscendant:i[r].isAsc})}return this.sort(e(n))}}).call(this.array),this.array.addRange=function(t){return g.array(Array.prototype.concat.call(this,t))},this.array.any=function(t){for(var e=this.length,n=-1;++n<e;)if(t(this[n]))return!0
return!1},this.array.replace=function(t,e){for(var n=this.length,i=-1;++i<n;)this[i]===t&&this.splice(i,1,e)}
var T=g.array(["Arguments","Function","String","Number","Date","RegExp"])
T.each(function(t){g["is"+t]=function(e){return a.toString.call(e)==="[object "+t+"]"}}),this.getData=function(t){for(var e=t;o(e);)e=e()
return e}
var _=1
this.bind=function(t,e,n,i){if(t=t||m,void 0===t||null===t)throw"Element must be specified"
if(void 0===e||null===e)throw"Event name must be specified"
if(void 0===n||null===n)throw"Callback must be specified"
t.addEventListener?t.addEventListener(e,n,i):t.attachEvent("on"+e,n)
var r=t.uniqueId||++_
t.uniqueId=r,A[e]=A[e]||{},A[e][r]=A[e][r]||[],A[e][r].push(n)},this.trigger=function(t,n){if(n=n||m,!n)throw"Element must be specified"
if(!t)throw"Event name must be specified"
var i
e.createEvent?(i=e.createEvent("HTMLEvents"),i.initEvent(t,!0,!0)):e.createEventObject&&(i=e.createEventObject(),i.eventType=t)
try{return void n[t]()}catch(r){}try{i.eventName=t,n.dispatchEvent?n.dispatchEvent(i):n.fireEvent?n.fireEvent("on"+i.eventType,i):n["on"+t]&&n["on"+t]()}catch(r){}},this.dispose=function(t){this.unbindAll(t),t&&t.parentElement&&t.parentElement.removeChild(t)},this.unbindAll=function(t){if(t=t||m,null===t||void 0===t)throw"Element to unbind all events must be specified"
var e=t.uniqueId
if(e&&D(A,function(n,i){var r=n[e]
if(s(r)){for(;r.length;){var a=r.pop()
o(a)&&g.unbind(i,a,!1,t,!0)}delete n[e]}}),null!==t&&t.children&&t.children.length)for(var n=0;n<t.children.length;n++)this.unbindAll(t.children[n])},this.unbind=function(t,e,n,i,r){if(i=i||m,!m)throw"Element to unbind event must be specified"
if(!t)throw"Event name must be specified"
e||D(A,function(e,r){if(r===t){var a=e[i.uniqueId]
if(s(a)){for(;a.length;){var o=a.pop()
i.removeEventListener?i.removeEventListener(t,o,n):i.detachEvent("on"+t,o)}delete e[i.uniqueId]}}})
try{i.removeEventListener?i.removeEventListener(t,e,n):i.detachEvent("on"+t,e),void 0!==r&&A[t][i.uniqueID]&&(R.remove.call(A[t][i.uniqueID],e),0===A[t][i.uniqueID].length&&delete S[i.uniqueId])}catch(a){}},this.subscribe=function(t,e){t&&t.subscribe&&t.subscribe(e)},this.unsubscribe=function(t,e){t&&t.subscribe&&t.unsubscribe(e)},this.disposable=function(t,e,n){if(null===t||!d(t)){if(!e||!n)throw"Observer and listener must be specified"
g.unsubscribe(e,n),null!==t&&g.dispose(t)}},this.createElement=function(t,n){var i=e.createElement(t)
return n&&(i.type=n),m.appendChild(i),m=i},this.createEleNoParent=function(t){return m=e.createElement(t),this}
var L=function(t,e,n){e*=n
for(var i=[],r=0;n>r&&t.children.length;r++)i.push(t.children[e]),t.removeChild(t.children[e])
setTimeout(function(){for(var t=0;n>t;t++)g.unbindAll(i[t])
i=null})},O=function(t,e,n){var i=null
if(0===e.children.length)throw"You must add at least one element"
if(n*=e.children.length,i=t.children[n],!i)for(;e.children.length;)t.appendChild(e.children[0])
for(;e.children.length;)t.insertBefore(e.children[0],i)}
this.each=function(t,n){if(!t)throw"Invalid argument exception. You must pass an array or observerd array."
var i=m
g.get(i).empty()
for(var r=g.getData(t),a=r.length||r,s=-1;++s<a;)m=i,n.call(i,u(r[s])?s:r[s],s)
var o=function(r,a,s,o){var l
if(g.disposable(i,t,this),!d(i))return void(i=null)
switch(m=i,o){case"push":n.call(i,a,s)
break
case"add":if(s===r.length-1)return void n.call(i,a,s)
var c=e.createElement("tmp")
m=c,n.call(c,a,s),O(i,c,s),g.dispose(c),c=null
break
case"remove":l=i.children.length/r.length,L(i,s,l)
break
case"move":l=i.children.length/r.length
var h=s,f=r.indexOf(a)
if(h===f)return
for(var p=f*l,v=h>f?i.children[(h+1)*l]:i.children[h*l],y=0;l>y;y++)i.insertBefore(i.children[p],v),f>h&&p++
break
case"render":g.empty()
for(var b=r.length||r,D=-1;++D<b;)m=i,n.call(i,u(r[D])?D:r[D],D)}}
return this.subscribe(t,o),this},this.quickEach=function(t,e){var n=g.getData(t)
if(s(n))for(var i=n.length,r=-1,a=m;++r<i;)m=a,e.call(m,n[r])},this.append=function(t){if(t.nodeName)return m.appendChild(t),this
var e=m
return t(),m=e,e=null,this},this.enable=function(t){var e=m,n=function(n){n?(e.disabled=!1,e.removeAttribute("disabled")):(e.disabled=!0,e.setAttribute("disabled","disabled")),g.disposable(e,t,this),d(e)||(e=null)}
return n(g.getData(t)),this.subscribe(t,n),this},this.element=this.$$=function(){return m},g.iff=function(t,e){var n=m
return e.call(n,g.getData(t)),g.subscribe(t,function(i){i?(m=n,0===n.children.length&&e.call(n)):(g(n).empty(),g.unbindAll(n)),g.disposable(n,t,this),d(n)||(n=null)}),o(t)||(n=null),g},this.displayErrorMessage=function(t,e,n){var i=n.nextSibling
i=i&&"span"===i.nodeName.toLowerCase()&&"html-error"===i.className&&i||null
var r=g.array.firstOrDefault.call(t,function(t){return t.isValid===!1})
t.length&&null!==r?(i?i.innerHTML=r.message:g.createEleNoParent("span").text(r.message).className("html-error"),i=i||m,i&&g(i).insertAfter(n)):i&&i.parentElement.removeChild(i),e.displayDefaultErrorMessage===!1&&i&&i.parentElement.removeChild(i),i=null,d(n)||(n=null)}
var V=["input","textarea"]
R.each.call(V,function(t){g[t]=function(e,r){var a=m.nodeName.toLowerCase()===t?m:this.createElement(t),s=this.getData(e)
if(""!==a.value&&g.isNoU(s)&&(E=a,e(a.value)),a.value=s||a.value,o(e)){n(e,a,r)
var l=c(e.lazyInput)?e.lazyInput:this.config.lazyInput,u=function(){var t=this.value
e.isComputed&&!e.isComputed()?e(t,!0):e.refresh()}
y&&!l?this.change(u).compositionend(u).compositionstart(u).cut(u).keydown(u).keyup(u).paste(u):i||l?i&&!l?this.keydown(u).keyup(u).change(u).cut(u).paste(u):this.change(u):this.change(u).compositionend(u).compositionstart(u).inputting(u),this.subscribe(e,function(t){a!==E&&(a.value=t),g.disposable(a,e,this),d(a)||(a=null)})}return this}}),this.searchbox=function(t,e){var n=e||g.data("")
return this.input(n),n.subscribe(function(e){t.filter(e)}),this},this.text=function(t){if(!t)return this
for(var e=m;null!==e.firstChild;)e.removeChild(e.firstChild)
var n=g.getData(t)
try{c(n)&&(e.innerText=n)}catch(i){c(n)&&(e.innerHTML=n)}var r=function(n){try{e.innerText=n}catch(i){e.innerHTML=n}g.disposable(e,t,this),d(e)||(e=null)}
return g.subscribe(t,r),this},this.html=function(t){if(!t)return this
for(var e=m;null!==e.firstChild;)e.removeChild(e.firstChild)
var n=g.getData(t)
try{c(n)&&(e.innerHTML=n)}catch(i){c(n)&&(e.innerText=n)}var r=function(n){try{e.innerHTML=n}catch(i){e.innerText=n}g.disposable(e,t,this),d(e)||(e=null)}
return g.subscribe(t,r),this},this.innerHTML=function(t){m.innerHTML=t}
var S=["click","contextmenu","dblclick","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseout","mouseup","keydown","keypress","keyup","abort","beforeunload","error","hashchange","load","resize","scroll","unload","blur","change","focus","focusin","focusout","inputting","invalid","reset","search","select","submit","drag","dragend","dragenter","dragleave","dragover","dragstart","drop","copy","cut","paste","afterprint","beforeprint","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting","animationend","animationiteration","animationstart","transitionend","message","online","offline","popstate","show","storage","toggle","wheel","compositionend","compositionstart"]
R.each.call(S,function(e){g[e]=function(n,i){var r="inputting"===e?"input":e
return n?(this.bind(m,r,function(e){e=e||t.event,E=e.srcElement||e.target,n&&n.call(E,e,i)},!1),this):(g.trigger(r),this)}}),this.radio=function(t,e,i){t=t||"",i=i||""
var r=this.createElement("input","radio")
r.name=t,r.value=e
var a=this.getData(i)
if(a===r.value?(r.setAttribute("checked","checked"),r.checked=!0):(r.removeAttribute("checked"),r.checked=!1),o(i)){n(i,r)
var s=function(){i.isComputed()?i.refresh():i(this.value)}
this.change(s).click(s),this.subscribe(i,function(t){return g.disposable(r,i,this),d(r)?void(t===r.value?(r.setAttribute("checked","checked"),r.checked=!0):(r.removeAttribute("checked"),r.checked=!1)):void(r=null)})}return this},this.checkbox=function(t){var e="input"===m.nodeName.toLowerCase()&&"checkbox"===m.type?m:this.createElement("input","checkbox"),i=g.getData(t)
if("true"===i||i===!0?(e.setAttribute("checked","checked"),e.checked=!0):(e.removeAttribute("checked"),e.checked=!1),o(t)){n(t,e)
var r=function(){t.isComputed()?t.refresh():t(this.checked===!0)}
this.change(r).click(r),this.subscribe(t,function(n){return g.disposable(e,t,this),d(e)?void(e!==E&&("true"===n||n===!0?(e.setAttribute("checked","checked"),e.checked=!0):(e.removeAttribute("checked"),e.checked=!1))):void(e=null)})}else e=null
return this},this.button=function(t){return this.createElement("button"),this.text(t),this}
var N=this.addClass=function(t,e){return u(e)&&(e=t,t=m),e=w(e),t&&""!==e?(t.className+=""===t.className?e:" "+e,this):this},q=this.removeClass=function(t,e){if(u(e)&&(e=t,t=m),!t||""===e)return this
for(var n=t.className;-1!==n.indexOf(e);)n=n.replace(e,""),n=w(n)
return t.className=n,this}
this.hasClass=function(t,e){return u(e)&&(e=t,t=m),t.className.indexOf(e)>=0},this.className=function(t){var e=m,n=g.getData(t)
return N(e,n),this.subscribe(t,function(n,i){q(e,i),N(e,n),g.disposable(e,t,this),d(e)||(e=null)}),this},this.id=function(t){return m.id=t,g.id[t]="#"+t,this},this.attr=function(t){var e=m,n=g.getData(t)
for(var i in n)n.hasOwnProperty(i)&&(e.setAttribute(i,g.getData(n[i])),f(n[i],i,e))
return t.subscribe&&t.subscribe(function(t){for(var n in t)t.hasOwnProperty(n)&&e.setAttribute(n,t[n])}),this},this.dropdown=function(t,e,i,r){var a=g.getData(e),s="select"===m.nodeName.toLowerCase()?m:this.createElement("select")
return this.each(t,function(t){var e=l(r)?t[r]:t,n=l(i)?t[i]:t
g.option(n,e,t===a).$()}),o(e)&&(n(e,s),this.change(function(){for(var n=g.getData(t)[this.selectedIndex],i=0,r=g.getData(t).length;r>i;i++)i===this.selectedIndex&&e(n)}),e.subscribe(function(e){var n=g.getData(t),i=n.indexOf(e)
s.options[i].selected=!0,s.options[i].setAttribute("selected","selected")})),this},this.select=function(){return this.createElement("select"),this},this.option=function(t,e,n){var i=this.createElement("option"),r="selected"
i.value=g.getData(e),i.text=g.getData(t),g.getData(n)===!0&&(i.setAttribute(r,r),i.selected=!0)
var a=function(t){t===!0?(i.setAttribute(r,r),i.selected=!0):(i.removeAttribute(r),i.selected=!1)}
return g.subscribe(n,a),this},this.empty=function(t){for(t=t||m;t&&t.firstChild;)g.unbindAll(t.firstChild),t.removeChild(t.firstChild)
return this}
var P=/-([a-z])/g,I=function(t,e){return e.toUpperCase()}
this.css=function(t,n){var i=l(t)&&t
if(l(t)&&l(n))return m.style[i]=n,this
if(l(t)&&u(n))return e.defaultView?e.defaultView.getComputedStyle(m,null).getPropertyValue(i):m.currentStyle&&m.currentStyle[i.replace(P,I)]
var r=g.getData(t)
r&&g.extend(m.style,r)
var a=m
return g.subscribe(t,function(e){e&&(g.extend(a.style,e),g.disposable(a,t,this),d(a)||(a=null))}),this},this.visible=function(t,e){var n=m,i=g.getData(t),r=g.css("display")
g.expando("display","none"===r?"":r)
var a=function(i){i?e?g(n).css("display",g(n).expando("display")||"initial"):g(n).css("visibility","visible"):e?g(n).css("display","none"):g(n).css("visibility","hidden"),g.disposable(n,t,this),d(n)||(n=null)}
return a(i),this.subscribe(t,a),this},this.hidden=function(t,e){var n=m,i=g.getData(t),r=g.css("display")
g.expando("display","none"===r?"":r)
var a=function(i){i?e?g(n).css("display","none"):g(n).css("visibility","hidden"):e?g(n).css("display",g(n).expando("display")):g(n).css("visibility","visible"),g.disposable(n,t,this),d(n)||(n=null)}
return a(i),this.subscribe(t,a),this},this.insertAfter=function(t){t.parentNode.insertBefore(m,t.nextSibling)},this.insertBefore=function(t){t.parentNode.insertBefore(m,t)},this.isDirty=function(t){return g.data().isDirty(t)},this.offset=function(){var t,e,n={top:0,left:0},i=m&&m.ownerDocument
return t=i.documentElement,"undefined"!=typeof m.getBoundingClientRect&&(n=m.getBoundingClientRect()),e=v(i),{top:n.top+e.pageYOffset-t.clientTop,left:n.left+e.pageXOffset-t.clientLeft}}
var j=[]
this.data=function(t){var e=!1,n=function(t,i){if(null===t||void 0===t){var r
return o(n._newData)?(j.push(n),r=g.getData(n._newData),j.pop()):r=n._newData,j.length&&n.setDependency(j[j.length-1]),r}n._newData!==t&&(e=!0,n._oldData=g.getData(n._newData),n._newData=t,i||(E=null),d())}
n.targets=[],n.dependencies=[],n.validators=[],n.validationResults=[],n.validationCallback=null,n.displayDefaultErrorMessage=null,n._newData=t,n._oldData=null,n.filteredArray=null,o(n._newData)&&(j.push(n),n._oldData=g.getData(n._newData),j.pop()),n.delay=function(t){return void 0===t?n.delayTime:(h(t)&&(n.delayTime=t),this)},n.setDependency=function(t){var e=R.indexOf.call(n.dependencies,t)
0>e&&n.dependencies.push(t)},n.isComputed=function(){return j.length&&n.setDependency(j[j.length-1]),o(n._newData)},n.isDirty=function(t){if(j.length&&n.setDependency(j[j.length-1]),e)return!0
if(t=t||n._newData,!b(t))return!1
for(var i in t)if(t.hasOwnProperty(i)){if(t[i].isDirty&&t[i].isDirty())return!0
if(b(t[i])&&n.isDirty(t[i]))return!0}return!1},n.subscribe=function(t){return o(t)&&R.indexOf.call(n.targets,t)<0&&n.targets.push(t),this},n.unsubscribe=function(t){setTimeout(function(){var e=R.indexOf.call(n.targets,t)
n.targets.splice(e,1)})}
var i,r,a=function(){var t
n.validate(),o(n._newData)&&(j.push(n),t=g.getData(n._newData),j.pop()),0===n.validators.length&&l(),t=n.filteredArray||t||g.getData(n._newData),R.each.call(n.targets,function(e){e.call(e,t,n._oldData,null,"render")}),n._oldData=t},l=function(){r&&clearTimeout(r),r=setTimeout(function(){R.each.call(n.dependencies,function(t){t.refresh()})})},d=n.refresh=function(){u(n.delayTime)?a():h(n.delayTime)&&(i&&clearTimeout(i),i=setTimeout(a,n.delayTime))}
return n.serialize=function(){return j.length&&n.setDependency(j[j.length-1]),g.serialize(n._newData)},g.extend(n,g.data.validation),g.extend(n,g.data.extensions),n.setValidationResult=function(t,e){n.validationResults.push({isValid:t,message:e}),n.validators.length!==n.validationResults.length&&t||(n.validationCallback&&n.validationCallback(n.validationResults),l())},n.validate=function(t){if(t)n.validators.push(t)
else{for(;n.validationResults.length;)n.validationResults.pop()
n.validators&&R.each.call(n.validators,function(t){t.call(n,n._newData,n._oldData)})}},n.isValid=function(t){return j.length&&n.setDependency(j[j.length-1]),t===!0||t===!1?(n.validationResults.length&&R.each.call(n.validationResults,function(e){e.isValid=t}),t&&n.validationCallback&&n.validationCallback(n.validationResults),n.isValid.state=t,t):n.validators&&n.validators.length!==n.validationResults.length?n.isValid.state||!1:!R.any.call(n.validationResults,function(t){return t.isValid===!1})},s(t)?(n.add=function(t,i){e=!0,i=void 0===i?n._newData.length:i,n._newData.splice(i,0,t),c(n.filteredArray)&&(n.filteredArray.push(t),i=n.filteredArray.length)
var r=n.filteredArray||n._newData
return R.each.call(n.targets,function(e){e.call(e,r,t,i,"add")}),l(),this},n.remove=function(t){e=!0
var i=R.indexOf.call(n._newData,t)
return this.removeAt(i),this},n.removeAt=function(t){e=!0
var i=n._newData[t],r=n._newData
if(n.filteredArray){if(t=R.indexOf.call(n.filteredArray,i),0>t)return
n.filteredArray.splice(t,1),r=n.filteredArray}return R.each.call(n.targets,function(e){e.call(e,r,i,t,"remove")}),n._newData.splice(t,1),i=null,l(),this},n.pop=function(){return e=!0,this.removeAt(n._newData.length-1),this},n.push=function(t){e=!0
var i=n._newData.length
n._newData.push(t),c(n.filteredArray)&&(i=n.filteredArray.length,n.filteredArray.push(t))
var r=n.filteredArray||n._newData
R.each.call(n.targets,function(e){e.call(e,r,t,i,"push")}),l()},n.move=function(t,i){e=!0
var r=n.filteredArray||n._newData,a=r[t]
R.each.call(n.targets,function(t){t.call(t,r,a,i,"move")}),l(),R.move.call(r,t,i),n.filteredArray&&(t=R.indexOf(n._newData,r[t]),i=R.indexOf(n._newData,r[i]),R.move.call(n._newData,t,i))},n.swap=function(t,n){e=!0,t!==n&&(t>n&&(t+=n,n=t-n,t-=n),this.move(t,n),t!==n-1&&this.move(n-1,t))},n.splice=function(t,n,i){e=!0
for(var r=0;n>r;r++)this.removeAt(t)
if(s(i))for(r=i.length-1;r>=0;r--)this.add(i[r],t)
else c(i)&&this.add(i,t)},n.orderBy=function(){var t=arguments
return R.orderBy.apply(n._newData,t),n.filteredArray&&R.orderBy.apply(n.filteredArray,t),d(),this},n.where=function(){var t=arguments
return n.filteredArray=R.where.apply(n._newData,t),n.filteredArray&&n.filteredArray.length?(d(),l(),this):(n.filteredArray=null,this)},n.filter=function(t){if(!t)return n.filteredArray=null,d(),this
var e=null
n.filteredArray=g.array([])
for(var i=0,r=n._newData.length;r>i;i++)e=g.serialize(n._newData[i]),x(C(e)).indexOf(x(t))>=0&&n.filteredArray.push(n._newData[i])
return d(),this},n.getFilterResult=function(){return n.filteredArray},n.setFilterResult=function(t){s(t)&&(n.filteredArray=g.array(t),d())},n):n},this.data.extensions={},this.data.validation={},this.data.validation={required:function(t){return this.validate(function(e){e=e&&e.toString()||"",c(e)&&""!==w(e)?this.setValidationResult(!0,t):this.setValidationResult(!1,t)}),this},isNumber:function(t){return this.validate(function(e){c(e)&&h(e)?this.setValidationResult(!0,t):this.setValidationResult(!1,t)}),this},isEmail:function(t){return this.validate(function(e){c(e)&&/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(e)?this.setValidationResult(!0,t):this.setValidationResult(!1,t)}),this},pattern:function(t,e){return this.validate(function(n){c(n)&&t.test(n)?this.setValidationResult(!0,e):this.setValidationResult(!1,e)}),this},maxLength:function(t,e){return this.validate(function(n){l(n)&&n.length<=t?this.setValidationResult(!0,e):this.setValidationResult(!1,e)}),this},minLength:function(t,e){return this.validate(function(n){l(n)&&n.length<t?this.setValidationResult(!1,e):this.setValidationResult(!0,e)}),this},stringLength:function(t,e,n){return this.validate(function(i){l(i)&&(i.length<t||i>e)?this.setValidationResult(!1,n):this.setValidationResult(!0,n)}),this},range:function(t,e,n){return this.validate(function(i){h(i)?parseFloat(i)<t?this.setValidationResult(!1,n||"The value can't be less than "+t+"."):parseFloat(i)>e?this.setValidationResult(!1,n||"The value can't be greater than "+e+"."):this.setValidationResult(!0,n):this.setValidationResult(!1,"The value must be a number.")}),this},greaterThan:function(t,e){return this.validate(function(n){n<=g.getData(t)?this.setValidationResult(!1,e):this.setValidationResult(!0)}),this},lessThan:function(t,e){return this.validate(function(n){n>=g.getData(t)?this.setValidationResult(!1,e):this.setValidationResult(!0)}),this},greaterThanOrEqual:function(t,e){return this.validate(function(n){n<g.getData(t)?this.setValidationResult(!1,e):this.setValidationResult(!0)}),this},lessThanOrEqual:function(t,e){return this.validate(function(n){n<g.getData(t)?this.setValidationResult(!1,e):this.setValidationResult(!0)}),this},equal:function(t,e){return this.validate(function(n){n!==g.getData(t)?this.setValidationResult(!1,e):this.setValidationResult(!0)}),this}},this.data.refresh=function(t){if(t.isComputed&&t.isComputed())return void t.refresh()
for(var e in t)t[e].isComputed&&t[e].isComputed()&&t[e].refresh()},this.serialize=function(t){t=t&&t.isComputed?t():t
var e=s(t),n=e?[]:{},i=b(t)||!c(t)
if(!i)return t
for(var r in t)t[r]&&t[r].isComputed&&!t[r].add?n[r]=t[r]():n[r]=g.serialize(t[r])
if(e){r=0
for(var a=t.length;a>r;r++)n[r]=g.serialize(t[r])}return n},g.tags=g.data([]),g.tags.subscribe(function(t,e){Object.defineProperty(g,e,{get:function(){return g.createElement(e),g}}),Object.defineProperty(g,"$"+e,{get:function(){try{if(m.nodeName.toLowerCase()===e)return m=m.parentElement,g
for(;m.nodeName.toLowerCase()!==e;)m=m.parentElement
m=m.parentElement}catch(t){throw"The parent element "+e+" does not exist"}return g}})})
var M=["div","a","i","table","tbody","thead","th","tr","td","tfoot","form","button","fieldset","label","legend","span","p","ul","ol","li","h1","h2","h3","h4","h5","h6","img"]
R.each.call(M,function(t){g.tags.push(t)}),Object.defineProperty(g,"$",{get:function(){return m=m.parentElement,g}}),Object.defineProperty(g,"br",{get:function(){return m.appendChild(e.createElement("br")),g}}),Object.defineProperty(g,"hr",{get:function(){return m.appendChild(e.createElement("hr")),g}})}.call(g),function(){this.ready=function(t){a(t),c()}
var n=!1,i=!1,r=[],a=function(t){o(t)&&r.push(t)},s=function(){for(;r.length;)r.shift()()
a=function(t){t()}},l=function(){e.addEventListener?e.removeEventListener("DOMContentLoaded",l,!1):e.detachEvent("onreadystatechange",l),u()},u=function(){if(!i){if(!e.body)return setTimeout(u,1)
i=!0,s()}},c=function(){var i=!1
if(!n)if(n=!0,"loading"!==e.readyState&&u(),e.addEventListener)e.addEventListener("DOMContentLoaded",l,!1),t.addEventListener("load",l,!1)
else if(e.attachEvent){e.attachEvent("onreadystatechange",l),t.attachEvent("onload",l)
try{i=null===t.frameElement}catch(r){}e.documentElement.doScroll&&i&&h()}},h=function(){if(!i){try{e.documentElement.doScroll("left")}catch(t){return void setTimeout(h,1)}u()}}}.call(g),function(){var t,n=/\D+/g,i="outline-color",r="rgb(00,00,07)",a=/-([a-z])/g,s=function(t,e){return e.toUpperCase()},o=function(t){var n=e.getElementById(t)
if(n){if(n.attributes.id&&n.attributes.id.value===t)return n
for(var i=1;i<e.all[t].length;i++)if(e.all[t][i].attributes.id&&e.all[t][i].attributes.id.value===t)return e.all[t][i]}return null},l=e.createElement("style")
e.defaultView&&e.defaultView.getComputedStyle?t=function(t,e){return t.ownerDocument.defaultView.getComputedStyle(t,null).getPropertyValue(e)}:e.documentElement.currentStyle&&(t=function(t,e){return t.currentStyle&&t.currentStyle[e.replace(a,s)]}),this.query=this.querySelectorAll=function(a,s,u){s=s||e,u=u||[]
var c,h=u.length||0
e.getElementsByTagName("head")[0].appendChild(l)
try{l.innerHTML=a+"{"+i+":"+r+"}"}catch(d){l.styleSheet.cssText=a+"{"+i+":"+r+"}"}if(e.defaultView&&e.querySelectorAll){c=""
var f=s.id,p=s
s!==e&&(c="__slim__",s.id=c,c="#"+c+" "),s=e.querySelectorAll(c+a),f?p.id=f:p.removeAttribute&&p.removeAttribute("id"),a=1}else!s[0]&&(c=/(.*)#([\w-]+)([^\s>~]*)[\s>~]*(.*)/.exec(a))&&c[2]&&(s=o(c[2]),c[4]||(s=[s],c[1]||c[3]||(a=1)))
s=1===a||s[0]&&1===s[0].nodeType?s:s.getElementsByTagName(a.replace(/\[[^\]]+\]|\.[\w-]+|\s*$/g,"").replace(/^.*[^\w]/,"")||"*")
for(var v=0,m=s.length;m>v;v++)1!==s[v].nodeType||1!==a&&7!==t(s[v],i).replace(n,"")||(u[h++]=s[v])
return u.length=h,e.getElementsByTagName("head")[0].removeChild(l),g.array(u)},this.querySelector=function(t,e,n){return this.querySelectorAll(t,e,n)[0]}}.call(g),function(){var n={},i={},r=g.array([]),a=g.array([]),u=g.array([]),c=[],h=e.getElementsByTagName("head")[0]||g.querySelector("head")||g(e).createElement("head").$$(),d=function(){var e,n=!1
if(l(a)?r.each(function(t){t.url===a&&t.isLoaded&&(n=!0)}):s(a)&&(n=!0,a.each(function(t){var e=r.firstOrDefault(function(e){return e.url===t&&e.isLoaded})
e||(n=!1)})),n){for(;o(u[0]);)e=u.shift(),c.push(e)
if(0===u.length)for(var i=c.length-1;i>=0;i--)e=c[i],e.apply(t,g.module(e.__requiredModules__)||[])
return g.scripts.render(u.shift())}}
g.config.allowDuplicate=!1
var f=function(t,n){var i=r.firstOrDefault(function(e){return e.url===t})
if(i&&!g.config.allowDuplicate)return void n()
var a=e.createElement("script")
a.type="text/javascript",a.charset="utf-8",a.async=!0
var s=function(){a.parentElement.removeChild(a),r.push({url:t,isLoaded:!0}),n()}
return void 0!==a.onreadystatechange?a.onload=a.onreadystatechange=function(){("complete"===this.readyState||"loaded"===this.readyState)&&s()}:g.bind(a,"load",s),a.src=t,h.appendChild(a),a},p=function(t){var n=r.firstOrDefault(function(e){return e.url===t})
if(!n||g.config.allowDuplicate){var i=e.createElement("link")
return i.type="text/css",i.rel="stylesheet",i.href=t,i.async=!0,h.appendChild(i),r.push({url:t,isLoaded:!0}),i}}
this.scripts=function(t){g.extend(n,t)},this.styles=function(t){g.extend(i,t)},this.scripts.render=function(t){var e=n[t]
if(e||(e=t),l(e))a=e,f(e,d)
else if(s(e)){a=g.array(e)
for(var i=0,r=e.length;r>i;i++)f(e[i],d)}return g.scripts},this.styles.render=function(t){var e=i[t]
if(e||(e=t),l(e))p(e)
else if(s(e))for(var n=0,r=e.length;r>n;n++)p(e[n])
return this},this.scripts.then=function(t){return u.push(t),this},this.styles.then=function(t){return g.styles.render(t)},this.scripts.done=function(t,e){return u.push(t),t.__requiredModules__=e,this},this.require=this.scripts.render}.call(g),function(){this.config.historyEnabled=!0
var n=this,i={},r=t.history,a=t.location,s=n.array([]),u=n.array([]),c=function(t){return new RegExp("^"+t.replace(/\//g,"\\/").replace(/\?/g,"\\?").replace(/:([0-9a-zA-Z-_]*)/g,"([0-9a-zA-Z-_]*)")+"$")}
this.router=function(t,e){var i,r,a,l=[],u=[e]
return i=n.Promise(function(){var e=s.any(function(e){return e.originalPattern===t})
if(e)throw"Duplicated pattern: "+t+". Please provide another pattern!"
s.push({originalPattern:t,pattern:c(t),doneActions:u,partialURL:r,scripts:l,container:a})}),i.partial=function(t,e){return r=t,a=e,i},i.scripts=function(t){return l.push(t),i},i.done=function(t){return o(t)&&u.push(t),i},i},this.navigate=function(t){return n.config.historyEnabled&&r.pushState?r.pushState(null,null,t):r.pushState||(a.hash=t),d.call(t),this},this.ignoreRoute=function(t){var e=s.firstOrDefault(function(e){return e.originalPattern===t})
if(e)throw"Pattern has been registered! Please check the routing configuration."
return u.push(c(t)),this}
var h=function(t,e,i){n.array.each.call(t,function(t){t.apply(e,i)})},d=function(t){var e=l(t)&&t||a.pathname+a.hash,r=u.any(function(t){return t.test(e)})
if(!r){var o=s.firstOrDefault(function(t){return t.pattern.test(e)})
if(o){i={}
var c=e.match(o.pattern)
c.shift(),n.array(o.originalPattern.match(/:(\w*)/g)).select(function(t){return t.replace(":","")}).each(function(t,e){i[t]=c[e]}),o.partialURL?n.partial(o.partialURL,o.container).done(function(){if(o.scripts){for(var t=n.scripts.render(o.scripts.shift());o.scripts.length;)t.then(o.scripts.shift())
t.done(function(){h(o.doneActions,i,c)})}else h(o.doneActions,i,c)}):h(o.doneActions,i,c)}}}
this.router.process=function(){setTimeout(function(){d()})},n(e).click(function(t){var e=t.target||t.srcElement,i=n.element()
try{e="a"!==e.nodeName.toLowerCase()?n(e).$a.element():e}catch(r){}n(i),i=null
var a=e.getAttribute("href"),s=""!==e.getAttribute("target")
if(!("_blank"===e.target||e.nodeName&&"a"!==e.nodeName.toLowerCase()||t.which>1||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey||t.defaultPrevented||t.getPreventDefault&&t.getPreventDefault()||t.returnValue===!1)){var o=/^(javascript|mailto):/.test(a)||u.any(function(t){return t.test(a.toLowerCase())})||s
o||(t.preventDefault?t.preventDefault():t.returnValue=!1,n.navigate(a))}}),n.config.historyEnabled&&r&&r.pushState?t.addEventListener("popstate",d):n.config.historyEnabled&&(t.addEventListener?t.addEventListener("hashchange",d):t.attachEvent("hashchange",d))}.call(g),function(){var t=g.array
this.Promise=function(e){var n,i,r=[],a=[],s=function(e){t.each.call(r,function(t){t&&t(e)}),u=null},l=function(e){t.each.call(a,function(t){t&&t(e)}),u=null},u={}
return u.done=function(t){return o(t)&&r.push(t),u},u.fail=function(t){return o(t)&&a.push(t),u},u.mockDone=function(t){return n=t,delete u.mockDone,delete u.mockFail,u},u.mockFail=function(t){return i=t,delete u.mockDone,delete u.mockFail,u},setTimeout(function(){n||i?n?s(n):l(i):e(s,l)}),u}
var i=function(){return new XMLHttpRequest},r=0,a=this.ajax=function(t,n,a,s){a=a||"GET",s=c(s)?s:!0
var o,u,h,d={},f=null,p=null,v=g.Promise(function(l,v){if(o){var m=t+(/\?/.test(t)?"&":"?"),y=e.getElementsByTagName("head")[0],b=e.createElement("script"),D=[],w=""
r++,g.ajax["jsonpId"+r]=o,n=n||{},n.callback="html.ajax.jsonpId"+r
for(w in n)n.hasOwnProperty(w)&&D.push(w+"="+encodeURIComponent(n[w]))
m+=D.join("&"),b.type="text/javascript",b.src=m,y.appendChild(b),g(b).expando("jsonpId",r)
var E=function(){b.parentElement.removeChild(b)
var t=g(b).expando("jsonpId")
g.ajax["jsonpId"+t]=void 0,b=null}
return void(void 0!==b.onreadystatechange?b.onload=b.onreadystatechange=function(){("complete"===this.readyState||"loaded"===this.readyState)&&E()}:g.bind(b,"load",E))}var A=i()
A.open(a,t,s,u,h),A.onreadystatechange=function(){if(4===A.readyState&&200===A.status){var t
try{t=c(f)?f(A.responseText||A.responseXML):A.responseText||A.responseXML}catch(e){v("Invalid data type.")}l(t)}else v(A)}
for(var x in d)d.hasOwnProperty(x)&&A.setRequestHeader(x,d)
p&&p>0&&(A.timeout=p,A.ontimeout=function(){v("timeout")}),A.send(n)})
return v.get=function(){return a="GET",this},v.post=function(){return a="POST",this},v.jsonp=function(t){return o=t,delete v.jsonp,this},v.authenticate=function(t,e){return u=t,h=e,this},v.header=function(t,e){return void 0!==e&&l(t)?d[t]=e:g.extend(d,t),this},v.async=function(t){return s=t,this},v.parser=function(t){return f=t,this},v.timeout=function(t){return p=t,this},v.contentType=function(t){return g.extend(d,{"Content-type":t}),this},v}
this.getJSON=function(t,e,i){var r=[]
for(var s in e)e.hasOwnProperty(s)&&r.push(encodeURIComponent(s)+"="+encodeURIComponent(e[s]))
return a(t+"?"+r.join("&"),null,"GET",i).parser(n.parse)},this.postJSON=function(t,e,i){return a(t,n.stringify(e),"POST",i).header({"Content-type":"application/json"}).parser(n.parse)},this.partial=function(t,e){c(e)&&g(e)
var n=g.element(),i=[],r=[],s=a(t)
return s.done(function(t){g(n).empty(),n.innerHTML=t,g.query("[id]",n).each(function(t){g.id[t.id]="#"+t.id}),n=null
for(var e=i&&g.scripts.render(i.shift());i.length;)e.then(i.shift())
e.done(function(){r&&g.array.each.call(r,function(e){e&&e(t)})})}),s.scripts=function(t){return i.push(t),s},s.done=function(t){return o(t)&&r.push(t),s},s}}.call(g),function(){var t={},e={}
this.module=function(n,i){if(u(i)){var r=s(n),a=[]
n=r?n:[n]
for(var o=0,l=n.length;l>o;o++)a.push(e[n[o]]||t[n[o]])
return r?a:a[0]}return t[n]=i,this},this.mockModule=function(t,n){return e[t]=n,this}}.call(g),g.ready(function(){g.query("[id]").each(function(t){g.id[t.id]="#"+t.id})}),g})
